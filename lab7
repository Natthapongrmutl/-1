#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct StudentNode {
    char name[20];
    int age;
    char sex;
    float gpa;
    struct StudentNode *next;
} StudentNode;


/* ---------- Utility: Create Node ---------- */
StudentNode *createNode(const char *name,
                        int age,
                        char sex,
                        float gpa)
{
    StudentNode *node = malloc(sizeof(StudentNode));

    if (node == NULL) {
        fprintf(stderr, "Memory allocation failed\n");
        exit(EXIT_FAILURE);
    }

    strcpy(node->name, name);
    node->age = age;
    node->sex = sex;
    node->gpa = gpa;
    node->next = NULL;

    return node;
}


/* ---------- Insert at head ---------- */
void insertHead(StudentNode **head,
                StudentNode **current,
                const char *name,
                int age,
                char sex,
                float gpa)
{
    StudentNode *node = createNode(name, age, sex, gpa);

    node->next = *head;
    *head = node;

    if (*current == NULL) {
        *current = node;
    }
}


/* ---------- Move to next node ---------- */
void moveNext(StudentNode **current)
{
    if (*current == NULL) {
        return;
    }

    if ((*current)->next == NULL) {
        return;
    }

    *current = (*current)->next;
}


/* ---------- Delete current node ---------- */
void deleteCurrent(StudentNode **head,
                   StudentNode **current)
{
    if (*head == NULL) {
        return;
    }

    if (*current == NULL) {
        return;
    }

    StudentNode *target = *current;

    if (*head == target) {
        *head = target->next;
        *current = *head;
        free(target);
        return;
    }

    StudentNode *previous = *head;

    while (previous->next != NULL &&
           previous->next != target)
    {
        previous = previous->next;
    }

    if (previous->next == NULL) {
        return;
    }

    previous->next = target->next;
    *current = target->next;

    free(target);
}


/* ---------- Print current node ---------- */
void printNode(const StudentNode *node)
{
    if (node == NULL) {
        return;
    }

    printf("%s %d %c %.2f\n",
           node->name,
           node->age,
           node->sex,
           node->gpa);
}


/* ---------- Print first two nodes safely ---------- */
void printFirstTwo(const StudentNode *head)
{
    if (head == NULL) {
        return;
    }

    if (head->next == NULL) {
        return;
    }

    printf("%s %s\n",
           head->name,
           head->next->name);
}


/* ---------- Free entire list ---------- */
void freeList(StudentNode **head)
{
    while (*head != NULL) {
        StudentNode *temp = *head;
        *head = (*head)->next;
        free(temp);
    }
}


/* ================= MAIN ================= */
int main(void)
{
    StudentNode *listA_head = NULL;
    StudentNode *listA_current = NULL;

    StudentNode *listB_head = NULL;
    StudentNode *listB_current = NULL;

    StudentNode *listC_head = NULL;
    StudentNode *listC_current = NULL;

    /* List A */
    insertHead(&listA_head, &listA_current, "one", 1, 'A', 1.1f);
    insertHead(&listA_head, &listA_current, "two", 2, 'B', 2.2f);
    insertHead(&listA_head, &listA_current, "three", 3, 'C', 3.3f);

    moveNext(&listA_current);
    printNode(listA_current);

    /* List B */
    insertHead(&listB_head, &listB_current, "four", 4, 'D', 4.4f);
    insertHead(&listB_head, &listB_current, "five", 5, 'E', 5.5f);
    insertHead(&listB_head, &listB_current, "six", 6, 'F', 6.6f);

    moveNext(&listB_current);
    deleteCurrent(&listB_head, &listB_current);
    printFirstTwo(listB_head);

    /* List C references A */
    listC_head = listA_head;
    listC_current = listC_head;

    moveNext(&listC_current);
    printNode(listC_current);

    /* List C references B */
    listC_head = listB_head;
    listC_current = listC_head;

    printFirstTwo(listC_head);

    freeList(&listA_head);
    freeList(&listB_head);

    return 0;
}
